@inherits Umbraco.Web.Mvc.UmbracoTemplatePage<ContentModels.Entry>
@using ContentModels = Umbraco.Web.PublishedContentModels;
@using System.Configuration;
@{
    Layout = "Master.cshtml";
    var entry = Model.Content;
    var home = (Home)Model.Content.Site();
}

@section Head {
    <link rel="stylesheet" type="text/css" href="~/assets/css/bootstrap-datepicker3.min.css">
}

@{ Html.RenderPartial("~/Views/Partials/PageHeader.cshtml");}

<!-- Main content Start -->
<div class="entry-main-content">
    <section id="entry">
        <div class="container">
            <div class="row match-my-cols">
                <div class="col-md-8 col-sm-7 entry-left-col">
                    <div id="entry-container">
                        <div class="title-header">
                            <h3 class="title-medium">Enter the Mid Sussex Triathlon on @home.RaceDate.ToString("dddd dd MMMM yyyy")</h3>
                        </div>
                        <div>
                            <form role="form" id="entryForm" data-toggle="validator" class="entry-form">
                                <div class="row">
                                    <div class="col-md-12">
                                        <h5 class="title-medium pull-left">Your details</h5>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group label-line">
                                            <span class="span"></span>
                                            <label class="label transition">First name*</label>
                                            <input type="text" class="input" id="firstName" required data-error="Please enter first name" maxlength="255">
                                            <div class="help-block with-errors"></div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group label-line">
                                            <span class="span"></span>
                                            <label class="label transition">Last name*</label>
                                            <input type="text" class="input" id="lastName" required data-error="Please enter last name" maxlength="255">
                                            <div class="help-block with-errors"></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group label-line">
                                            <span class="span"></span>
                                            <label class="label transition">Date of birth*</label>
                                            <input type="text" class="input" id="dob" required data-error="Please enter date of birth in format dd/mm/yyyy. You must be at least 16 years old."
                                                   data-date-format="dd/mm/yyyy" pattern="^([0-2][0-9]|(3)[0-1])(\/)(((0)[0-9])|((1)[0-2]))(\/)\d{4}$">
                                            <div class="help-block with-errors"></div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group label-line">
                                            <span class="span"></span>
                                            <label class="label transition">Category*</label>
                                            <select class="input" id="gender" name="gender" required data-error="Please select category">
                                                <option value=""></option>
                                                <option value="Open">open</option>
                                                <option value="Female">Female</option>
                                            </select>
                                            <div class="help-block with-errors"></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group label-line">
                                            <span class="span"></span>
                                            <label class="label transition">Phone number</label>
                                            <input type="text" class="input" id="phone" maxlength="255">
                                            <div class="help-block with-errors"></div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group label-line">
                                            <span class="span"></span>
                                            <label class="label transition">Email*</label>
                                            <input type="email" class="input" id="email" required data-error="Please enter email address in correct format" maxlength="255">
                                            <div class="help-block with-errors"></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-12">
                                        <h5 class="title-medium pull-left">Contact information</h5>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group label-line">
                                            <span class="span"></span>
                                            <label class="label transition">Address line 1*</label>
                                            <input type="text" class="input" id="address1" required data-error="Please enter address line 1" maxlength="255">
                                            <div class="help-block with-errors"></div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group label-line">
                                            <span class="span"></span>
                                            <label class="label transition">Address line 2</label>
                                            <input type="text" class="input" id="address2" maxlength="255">
                                            <div class="help-block with-errors"></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group label-line">
                                            <span class="span"></span>
                                            <label class="label transition">Town / City*</label>
                                            <input type="text" class="input" id="city" required data-error="Please enter town / city" maxlength="255">
                                            <div class="help-block with-errors"></div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group label-line">
                                            <span class="span"></span>
                                            <label class="label transition">County</label>
                                            <input type="text" class="input" id="county">
                                            <div class="help-block with-errors"></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group label-line">
                                            <span class="span"></span>
                                            <label class="label transition">Postcode*</label>
                                            <input type="text" class="input" id="postcode" required data-error="Please enter postcode" maxlength="255">
                                            <div class="help-block with-errors"></div>
                                        </div>
                                    </div>
                                </div>


                                <div class="row">
                                    <div class="col-md-12">
                                        <h5 class="title-medium pull-left">In Case of Emergency Contact information</h5>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group label-line">
                                            <span class="span"></span>
                                            <label class="label transition">First name*</label>
                                            <input type="text" class="input" id="emergencyContactFirstName" required data-error="Please enter first name" maxlength="255">
                                            <div class="help-block with-errors"></div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group label-line">
                                            <span class="span"></span>
                                            <label class="label transition">Last name*</label>
                                            <input type="text" class="input" id="emergencyContactLastName" required data-error="Please enter last name" maxlength="255">
                                            <div class="help-block with-errors"></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group label-line">
                                            <span class="span"></span>
                                            <label class="label transition">Phone number*</label>
                                            <input type="text" class="input" id="emergencyContactPhone" required maxlength="255">
                                            <div class="help-block with-errors"></div>
                                        </div>
                                    </div>
                                </div>


                                <div class="row">
                                    <div class="col-md-12">
                                        <h5 class="title-medium pull-left">Event details</h5>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group label-line label-line-radio">
                                            <span class="span"></span>
                                            <label class="label transition">Race type*</label>
                                            <label class="radio-inline">
                                                <input type="radio" name="raceType" id="raceType1" value="Full Triathlon" required> Triathlon
                                            </label>
                                            <label class="radio-inline">
                                                <input type="radio" name="raceType" id="raceType2" value="Aquabike" required> Aquabike
                                            </label>
                                            <div class="help-block with-errors"></div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group label-line label-line-radio">
                                            <span class="span"></span>
                                            <label class="label transition"> </label>
                                            @if (entry.EnableRelay == true)
                                            {
                                                <label class="radio-inline">
                                                    <input type="radio" name="raceType" id="raceType3" value="Relay Triathlon" required> Relay Triathlon
                                                </label>
                                            }
                                            @if (entry.EnableTryAtri == true)
                                            {
                                                <label class="radio-inline">
                                                    <input type="radio" name="raceType" id="raceType4" value="Try a Tri" required> Try a Tri
                                                </label>
                                            }
                                            <div class="help-block with-errors"></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group label-line label-line-time">
                                            <span class="span"></span>
                                            <label class="label transition">Swim time* (for 400 metres)</label>
                                            <input type="time" class="input" id="swimTime" min="04:00" max="20:00" required data-error="Please enter a swim time in format mm:ss between 04:00 and 20:00 minutes"
                                                   pattern="^[0-2][0-9]:[0-6][0-9]$">
                                            <div class="help-block with-errors"></div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group label-line">
                                            <span class="span"></span>
                                            <label class="label transition">BTF Number (required for BTF discount)</label>
                                            <input type="text" class="input" id="btfNumber" maxlength="255">
                                            <div class="help-block with-errors"></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group label-line">
                                            <span class="span"></span>
                                            <label class="label transition">Club name</label>
                                            <input type="text" class="input" id="clubName" maxlength="255">
                                            <div class="help-block with-errors"></div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group label-line label-line-radio">
                                            <span class="span"></span>
                                            <label class="label transition">Are you new to the sport?*</label>
                                            <label class="radio-inline">
                                                <input type="radio" name="newToSport" id="newToSport1" value="true" required> Yes
                                            </label>
                                            <label class="radio-inline">
                                                <input type="radio" name="newToSport" id="newToSport2" value="false" required> No
                                            </label>
                                            <div class="help-block with-errors"></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group label-line">
                                            <span class="span"></span>
                                            <label class="label transition">Where did you hear about us?*</label>
                                            <select class="input" id="howHeardAboutUs" name="howHeardAboutUs" required data-error="Please select where you heard about us">
                                                <option value=""></option>
                                                <option value="BTF listing">BTF listing</option>
                                                <option value="Email from MSTC">Email from Mid Sussex Tri Club</option>
                                                <option value="Facebook">Facebook</option>
                                                <option value="Friend recommended">Friend recommended</option>
                                                <option value="I've done it before">I've done it before</option>
                                                <option value="Local press or flyer">Local press or flyer</option>
                                                <option value="My Club">My Club</option>
                                                <option value="Web search">Web search</option>
                                                <option value="Other">Other</option>
                                            </select>
                                            <div class="help-block with-errors"></div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group label-line">
                                            <span class="span"></span>
                                            <label class="label transition">Discount Code</label>
                                            <input type="text" class="input" id="discountCode" maxlength="255" pattern=@entry.DiscountCode data-pattern-error ="Please enter valid Discount code.">
                                            <div class="help-block with-errors"></div>
                                        </div>
                                    </div>
                                </div>
                                <div id="relayFieldsContainer"></div>
                                <div class="row">
                                    <div class="col-md-12">
                                        <h5 class="title-medium pull-left">Credit or debit card</h5>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-12">

                                        <div id="card-element">
                                            <!-- A Stripe Element will be inserted here. -->
                                        </div>

                                        <!-- Used to display Element errors. -->
                                        <div id="card-errors" role="alert" class="payment-errors"></div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="form-group checkbox-field">
                                            @if (entry.TermsPage != null)
                                            {
                                                <a href="@entry.TermsPage.Url" target="_blank">Terms and Conditions</a>
                                            }
                                            <div class="checkbox">
                                                <label>
                                                    <input id="terms" type="checkbox" value="true" required> I have read and agree to the race terms and conditions.*
                                                </label>
                                            </div>
                                            <div class="help-block with-errors"></div>
                                        </div>
                                        <p>
                                            Confidentiality is important to us. The personal information you provide will remain confidential
                                            and will not be sold or distributed beyond our control. Your payment details are securely sent directly to our PCI compliant payment provider.
                                        </p>

                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="buttons">
                                            <button type="submit" id="form-submit" class="btn btn-common">
                                                Complete entry at £<span id="cost"></span>
                                            </button>
                                            <div id="msgSubmit" class="h3 text-center hidden"></div>
                                            <div class="clearfix"></div>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                    <div id="entry-confirmed" class="hidden">
                        <div class="title-header">
                            <h3 class="title-medium">Mid Sussex Triathlon entry complete</h3>
                        </div>
                        <div>
                            <form class="entry-form">
                                <div class="row">
                                    <div class="col-md-12">
                                        <h5 class="title-medium pull-left">You have entered the Mid Sussex Triathlon!</h5>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-12">
                                        @entry.EntryConfirmedText
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                    <div id="entry-error" class="hidden">
                        <div class="title-header">
                            <h3 class="title-medium">Entry not complete</h3>
                        </div>
                        <div>
                            <form class="entry-form">
                                <div class="row">
                                    <div class="col-md-12">
                                        <h5 class="title-medium pull-left">Sorry, there has been a problem processing your order</h5>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-12">
                                        Please <a href="/contact">get in touch</a> with us to let us know, providing your full name and we will investigate the problem.
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 col-sm-5 information">

                    <div class="info-container">
                        <div class="icon">
                            <i class="icon-hourglass"></i>
                        </div>
                        <div class="info">
                            <h5>Places left</h5>
                            <h3 id="placesLeft"></h3>
                        </div>
                    </div>

                    <div class="info-container">
                        <div class="icon">
                            <i class="fa fa-user"></i>
                        </div>
                        <div class="info">
                            <h5>Individual Entry</h5>
                            <h3>£<span id="eventCost">@Umbraco.Field("eventCost")</span>*</h3>
                        </div>
                    </div>

                    <div class="info-container">
                        <div class="icon">
                            <i class="fa fa-users"></i>
                        </div>
                        <div class="info">
                            <h5>Relay Entry</h5>
                            <h3>£<span id="relayEventCost">@Umbraco.Field("relayEventCost")</span>*</h3>
                        </div>
                    </div>

                    <div class="info-container">
                        <div class="icon">
                            <i class="fa fa-user"></i>
                        </div>
                        <div class="info">
                            <h5>Try a Tri Entry</h5>
                            <h3>£<span id="tryATriCost">@Umbraco.Field("tryATriCost")</span>*</h3>
                        </div>
                    </div>

                    <div class="info-container">
                        <div class="icon">
                            <i class="fa fa-envelope"></i>
                        </div>
                        <div class="info">
                            <h5>Impairments / Special request</h5>
                            @entry.ImpairmentsText
                        </div>
                    </div>
                    <div class="info-container">
                        <p>*Unless you are a BTF member you will be charged £<span id="btfLicenseCost">@Umbraco.Field("btfLicenseCost")</span> per person for a race day license. Enter your BTF number to avoid the charge.</p>
                    </div>
                </div>

                <div class="info-container" hidden="hidden">
                    <div class="info">
                        <h5>DiscountUnder25</h5>
                        <h3>£<span id="discountValue">@Umbraco.Field("discountValue")</span>*</h3>
                    </div>
                    <div class="info">
                        <h5>DiscountCode</h5>
                        <h3>£<span id="discountAmount">@Umbraco.Field("discountAmount")</span>*</h3>
                    </div>
                </div>

            </div>
    </section>
</div>
<!-- Main content End -->

@section Foot {
    <script type="text/javascript" src="~/assets/js/bootstrap-datepicker.min.js"></script>
    <script type="text/javascript" src="~/assets/js/form-validator.min.js"></script>
    <script type="text/javascript" src="~/assets/js/jquery.toast.js"></script>
    <script type="text/javascript" src="~/assets/js/entry.js?v=7"></script>

    <script type="text/javascript">
        var pkStripe = '@ConfigurationManager.AppSettings["stripePublicKey"]';

        $(document).ready(function () {
            initStripe(pkStripe);
        });
    </script>

    <script id="relayFields" type="template">
        <div class="row">
            <div class="col-md-12">
                <h5 class="title-medium pull-left">Second / Third Person Details for Relay</h5>
            </div>
        </div>
        <div class="row">
            <div class="col-md-6">
                <div class="form-group label-line">
                    <span class="span"></span>
                    <label class="label transition">Relay entrant 2 First name*</label>
                    <input type="text" class="input" id="relay2FirstName" required data-error="Please enter first name" maxlength="255">
                    <div class="help-block with-errors"></div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="form-group label-line">
                    <span class="span"></span>
                    <label class="label transition">Relay entrant 2 Last name*</label>
                    <input type="text" class="input" id="relay2LastName" required data-error="Please enter last name" maxlength="255">
                    <div class="help-block with-errors"></div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-6">
                <div class="form-group label-line">
                    <span class="span"></span>
                    <label class="label transition">Relay entrant 2 BTF number</label>
                    <input type="text" class="input" id="relay2BtfNumber" maxlength="255">
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-6">
                <div class="form-group label-line">
                    <span class="span"></span>
                    <label class="label transition">Relay entrant 3 First name</label>
                    <input type="text" class="input" id="relay3FirstName" data-error="Please enter first name" maxlength="255">
                </div>
            </div>
            <div class="col-md-6">
                <div class="form-group label-line">
                    <span class="span"></span>
                    <label class="label transition">Relay entrant 3 Last name</label>
                    <input type="text" class="input" id="relay3LastName" data-error="Please enter last name" maxlength="255">
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-6">
                <div class="form-group label-line">
                    <span class="span"></span>
                    <label class="label transition">Relay entrant 3 BTF number</label>
                    <input type="text" class="input" id="relay3BtfNumber" maxlength="255">
                </div>
            </div>
        </div>
    </script>
}


